<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Dealify</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ›ï¸%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/components.css">
  <link rel="stylesheet" href="../../css/dashboard.css">
  <link rel="stylesheet" href="../../css/responsive.css">
  <style>
    body { font-family: 'Inter', var(--font-family); }
    /* Admin Theme â€” Dark/Red */
    .navbar { background: linear-gradient(135deg, #1E1B4B, #312E81) !important; }
    .navbar .navbar-logo, .navbar .navbar-logo span { color: #fff !important; }
    .navbar .navbar-link, .navbar .navbar-link span { color: #fff !important; }
    .admin-badge { 
      background: linear-gradient(135deg, #EF4444, #DC2626);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .dashboard-sidebar { background: #1E1B4B; border-right: none; }
    .sidebar-header { background: linear-gradient(135deg, #312E81, #3730A3); border-bottom: 1px solid #4338CA; }
    .sidebar-avatar { background: #EF4444 !important; color: #fff !important; }
    .sidebar-user-info h4 { color: #fff !important; }
    .sidebar-user-info p { color: #A5B4FC !important; }
    .sidebar-section-title { color: #818CF8 !important; }
    .sidebar-link { color: #C7D2FE !important; }
    .sidebar-link:hover { background: rgba(255,255,255,0.08) !important; color: #fff !important; }
    .sidebar-link.active { background: rgba(99,102,241,0.2) !important; color: #fff !important; border-left: 3px solid #818CF8; }
    .sidebar-link .badge { background: #EF4444; color: #fff; }
    .stat-card { border-top: 3px solid transparent; }
    .stat-card:nth-child(1) { border-top-color: #8B5CF6; }
    .stat-card:nth-child(2) { border-top-color: #3B82F6; }
    .stat-card:nth-child(3) { border-top-color: #10B981; }
    .stat-card:nth-child(4) { border-top-color: #F59E0B; }
    .pending-card {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      border: 1px solid #F59E0B;
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }
    .pending-card h4 { color: #92400E; margin-bottom: 4px; }
    .pending-card p { color: #A16207; font-size: 0.85rem; }
    .pending-card .pending-count { 
      font-size: 2rem; 
      font-weight: 800; 
      color: #D97706;
      min-width: 50px;
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="admin-role-strip">ğŸ›¡ï¸ <strong>ADMIN PANEL</strong> â€” Full Platform Control</div>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-inner">
      <a href="../../index.html" class="navbar-logo">Deal<span>ify</span></a>
      <div style="flex:1;"></div>
      <div class="navbar-actions">
        <span class="admin-badge">ADMIN</span>
        <div class="user-dropdown">
          <button class="navbar-link" id="userDropdownBtn">
            <i data-lucide="shield"></i>
            <span id="navUserName">Admin</span>
          </button>
          <div class="user-dropdown-menu" id="userDropdownMenu">
            <a href="dashboard.html"><i data-lucide="layout-dashboard" style="width:16px;height:16px;"></i> Dashboard</a>
            <a href="users.html"><i data-lucide="users" style="width:16px;height:16px;"></i> Users</a>
            <a href="sellers.html"><i data-lucide="store" style="width:16px;height:16px;"></i> Sellers</a>
            <div class="user-dropdown-divider"></div>
            <button onclick="logout()"><i data-lucide="log-out" style="width:16px;height:16px;"></i> Logout</button>
          </div>
        </div>
      </div>
      <div class="hamburger" onclick="toggleSidebar()">
        <span></span><span></span><span></span>
      </div>
    </div>
  </nav>

  <div class="toast-container" id="toastContainer"></div>

  <!-- Dashboard Layout -->
  <div class="dashboard-wrapper">
    
    <!-- Sidebar -->
    <aside class="dashboard-sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-avatar" id="sidebarAvatar" style="background:#FEE2E2;color:#DC2626;">A</div>
        <div class="sidebar-user-info">
          <h4 id="sidebarName">Admin</h4>
          <p style="font-size:0.7rem;color:var(--muted);">Super Admin</p>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="sidebar-section">
          <div class="sidebar-section-title">Overview</div>
        </div>
        <a href="dashboard.html" class="sidebar-link active">
          <i data-lucide="layout-dashboard"></i> Dashboard
        </a>

        <div class="sidebar-section">
          <div class="sidebar-section-title">User Management</div>
        </div>
        <a href="users.html" class="sidebar-link">
          <i data-lucide="users"></i> All Users
        </a>
        <a href="sellers.html" class="sidebar-link">
          <i data-lucide="store"></i> Sellers
          <span class="badge badge-warning" id="pendingSellersCount">0</span>
        </a>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Catalog</div>
        </div>
        <a href="products.html" class="sidebar-link">
          <i data-lucide="package"></i> Products
        </a>
        <a href="categories.html" class="sidebar-link">
          <i data-lucide="grid-3x3"></i> Categories
        </a>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Business</div>
        </div>
        <a href="orders.html" class="sidebar-link">
          <i data-lucide="shopping-bag"></i> Orders
        </a>
        <a href="coupons.html" class="sidebar-link">
          <i data-lucide="ticket"></i> Coupons
        </a>
        <a href="#" class="sidebar-link" onclick="logout()">
          <i data-lucide="log-out"></i> Logout
        </a>
      </nav>
    </aside>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <main class="dashboard-content">
      
      <div class="page-header">
        <div>
          <h1>Admin Dashboard</h1>
          <p>Platform overview and management</p>
        </div>
      </div>

      <!-- Pending Seller Approvals -->
      <div class="pending-card" id="pendingCard" style="display:none;">
        <div class="pending-count" id="pendingCount">0</div>
        <div>
          <h4>Seller Approvals Pending</h4>
          <p>New sellers are waiting for your review and approval.</p>
        </div>
        <a href="sellers.html" class="btn btn-primary btn-sm" style="margin-left:auto;">Review Now â†’</a>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon purple">ğŸ‘¥</div>
          <div class="stat-info">
            <h3 id="statUsers">0</h3>
            <p>Total Users</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon blue">ğŸª</div>
          <div class="stat-info">
            <h3 id="statSellers">0</h3>
            <p>Total Sellers</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">ğŸ“¦</div>
          <div class="stat-info">
            <h3 id="statProducts">0</h3>
            <p>Total Products</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon orange">ğŸ›’</div>
          <div class="stat-info">
            <h3 id="statOrders">0</h3>
            <p>Total Orders</p>
          </div>
        </div>
      </div>

      <!-- Revenue & Admin-specific stats -->
      <div class="stats-grid" style="margin-top:var(--space-lg);">
        <div class="stat-card">
          <div class="stat-icon green">ğŸ’°</div>
          <div class="stat-info">
            <h3 id="statRevenue">â‚¹0</h3>
            <p>Total Revenue</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon purple">ğŸ’</div>
          <div class="stat-info">
            <h3 id="statCommission">â‚¹0</h3>
            <p>Commission Earned</p>
          </div>
        </div>
      </div>

      <!-- Dashboard Grid -->
      <div class="dashboard-grid" style="margin-top:var(--space-xl);">
        <div class="dashboard-card">
          <div class="dashboard-card-header">
            <h3>Recent Orders</h3>
            <a href="orders.html" class="btn btn-ghost btn-sm">View All â†’</a>
          </div>
          <div class="dashboard-card-body">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“‹</div>
              <h3>No orders yet</h3>
              <p>Platform orders will appear here</p>
            </div>
          </div>
        </div>

        <div class="dashboard-card">
          <div class="dashboard-card-header">
            <h3>Quick Actions</h3>
          </div>
          <div class="dashboard-card-body">
            <div class="quick-actions">
              <a href="users.html" class="quick-action-btn">
                <span style="font-size:1.5rem;">ğŸ‘¥</span>
                <span>Manage Users</span>
              </a>
              <a href="sellers.html" class="quick-action-btn">
                <span style="font-size:1.5rem;">ğŸª</span>
                <span>Manage Sellers</span>
              </a>
              <a href="products.html" class="quick-action-btn">
                <span style="font-size:1.5rem;">ğŸ“¦</span>
                <span>Products</span>
              </a>
              <a href="categories.html" class="quick-action-btn">
                <span style="font-size:1.5rem;">ğŸ“‚</span>
                <span>Categories</span>
              </a>
              <a href="orders.html" class="quick-action-btn">
                <span style="font-size:1.5rem;">ğŸ›’</span>
                <span>Orders</span>
              </a>
              <a href="coupons.html" class="quick-action-btn">
                <span style="font-size:1.5rem;">ğŸ«</span>
                <span>Coupons</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- New Sellers Table -->
      <div class="dashboard-card" style="margin-top:var(--space-xl);">
        <div class="dashboard-card-header">
          <h3>Recent Seller Applications</h3>
          <a href="sellers.html" class="btn btn-ghost btn-sm">View All â†’</a>
        </div>
        <div class="dashboard-card-body">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ¬</div>
            <h3>No pending applications</h3>
            <p>New seller applications will appear here for review</p>
          </div>
        </div>
      </div>

    </main>
  </div>

  <button class="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>

  <script src="../../js/app.js"></script>
  <script>
    lucide.createIcons();

    document.addEventListener('DOMContentLoaded', () => {
      const auth = getAuth();
      if (!auth || !auth.token || auth.user.role !== 'admin') {
        window.location.href = '../auth/login.html';
        return;
      }

      const name = auth.user.name || 'Admin';
      document.getElementById('navUserName').textContent = name.split(' ')[0];
      document.getElementById('sidebarAvatar').textContent = name.charAt(0).toUpperCase();
      document.getElementById('sidebarName').textContent = name;

      loadDashboardStats();
    });

    async function loadDashboardStats() {
      try {
        const response = await apiCall('/admin/dashboard');
        if (response && response.data) {
          const d = response.data;
          document.getElementById('statUsers').textContent = d.totalBuyers || 0;
          document.getElementById('statSellers').textContent = d.totalSellers || 0;
          document.getElementById('statProducts').textContent = d.totalProducts || 0;
          document.getElementById('statOrders').textContent = d.totalOrders || 0;
          document.getElementById('statRevenue').textContent = 'â‚¹' + (d.totalRevenue || 0);
          document.getElementById('statCommission').textContent = 'â‚¹' + (d.totalCommission || 0);

          const pending = d.pendingSellers || 0;
          document.getElementById('pendingSellersCount').textContent = pending;
          if (pending > 0) {
            document.getElementById('pendingCard').style.display = 'flex';
            document.getElementById('pendingCount').textContent = pending;
          }
        }
      } catch (err) {
        // Stats will load as 0 by default
      }
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
      document.getElementById('sidebarOverlay').classList.toggle('active');
    }

    document.getElementById('userDropdownBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      document.getElementById('userDropdownMenu').classList.toggle('active');
    });
    document.addEventListener('click', () => {
      document.getElementById('userDropdownMenu').classList.remove('active');
    });
  </script>
</body>
</html>
